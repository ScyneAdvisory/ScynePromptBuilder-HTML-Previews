<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interim Benefit Offer Response</title>
    <style>
        /* --- DESIGN SYSTEM: COLORS, TYPOGRAPHY, SPACING --- */
        :root {
            /* Legal Aid Colour Palette */
            --brand-primary-red: #C10E02; /* Empower Red */
            --brand-primary-red-dark: #A10C02;
            --brand-blue: #004A80; /* Trusted Blue */
            --brand-green: #21A179; /* Calming Green */
            --brand-text-dark: #1D1D1D;
            --brand-text-mid: #545454;
            --brand-border-light: #C8C8C8;
            --brand-border-focus: #C10E02;
            --brand-background-light: #F4F5F6;
            --brand-background-disabled: #E6E6E6;
            --brand-white: #FFFFFF;

            /* Spacing Tokens (8px grid) */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-xxl: 48px;

            /* Fonts */
            --font-family-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        }

        /* --- GLOBAL & RESET STYLES --- */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: var(--font-family-sans);
            background-color: var(--brand-background-light);
            color: var(--brand-text-dark);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: var(--spacing-lg);
        }

        /* --- TYPOGRAPHY STYLES (From Design System) --- */
        .heading-1 { /* Heading 1 */
            font-size: 2rem; /* 32px */
            font-weight: 700;
            line-height: 1.2;
            margin: 0 0 var(--spacing-md) 0;
            color: var(--brand-text-dark);
        }

        .heading-3 { /* Heading 3 */
            font-size: 1.25rem; /* 20px */
            font-weight: 600;
            line-height: 1.3;
            margin: 0 0 var(--spacing-sm) 0;
            color: var(--brand-text-dark);
        }

        .body-large-strong { /* Body 1 - Large Strong */
            font-size: 1rem; /* 16px */
            font-weight: 700;
        }

        .body-paragraph { /* Body 2 - Paragraph */
            font-size: 0.875rem; /* 14px */
            line-height: 1.5;
            color: var(--brand-text-mid);
        }
        
        .body-small { /* Body 3 - Small */
            font-size: 0.75rem; /* 12px */
            color: var(--brand-text-mid);
        }

        /* --- LAYOUT COMPONENTS (SLDS Inspired) --- */
        .container {
            width: 100%;
            max-width: 800px;
        }

        .slds-card {
            background-color: var(--brand-white);
            border: 1px solid var(--brand-border-light);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: opacity 0.3s ease-in-out;
        }

        .slds-card__header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--brand-border-light);
        }
        
        .slds-card__body {
            padding: var(--spacing-lg);
        }
        
        .slds-card__footer {
            padding: var(--spacing-md) var(--spacing-lg);
            border-top: 1px solid var(--brand-border-light);
            background-color: var(--brand-background-light);
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-sm);
        }
        
        .slds-section {
            padding: var(--spacing-lg) 0;
            border-bottom: 1px solid #E6E6E6;
        }
        .slds-section:last-of-type {
            border-bottom: none;
            padding-bottom: 0;
        }

        /* --- FORM ELEMENTS (SLDS Inspired) --- */
        .slds-form-element {
            margin-bottom: var(--spacing-lg);
        }
        
        .slds-form-element__label {
            display: block;
            font-size: 0.875rem; /* 14px */
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            color: var(--brand-text-dark);
        }
        
        .slds-input {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--brand-border-light);
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .slds-input[readonly] {
            background-color: var(--brand-background-disabled);
            cursor: not-allowed;
            border-color: transparent;
        }

        .slds-input:focus {
            outline: none;
            border-color: var(--brand-blue);
            box-shadow: 0 0 0 2px rgba(0, 74, 128, 0.2);
        }

        .slds-form-element.slds-has-error .slds-input {
            border-color: var(--brand-primary-red);
            box-shadow: 0 0 0 2px rgba(193, 14, 2, 0.2);
        }

        .slds-form-element__help {
            font-size: 0.75rem;
            color: var(--brand-primary-red);
            margin-top: var(--spacing-xs);
        }

        /* --- CUSTOM RADIO & CHECKBOX (CRITICAL REQUIREMENT) --- */
        .slds-radio, .slds-checkbox {
            position: relative;
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 1rem;
            user-select: none;
            margin-bottom: var(--spacing-sm);
        }

        .slds-radio input, .slds-checkbox input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }
        
        .slds-radio .slds-radio__label, .slds-checkbox .slds-checkbox__label {
            padding-left: 28px;
            line-height: 1.5;
        }
        
        .slds-radio .checkmark, .slds-checkbox .checkmark {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            left: 0;
            height: 20px;
            width: 20px;
            background-color: var(--brand-white);
            border: 2px solid var(--brand-border-light);
            transition: all 0.2s ease;
        }

        .slds-radio .checkmark {
            border-radius: 50%;
        }

        .slds-checkbox .checkmark {
            border-radius: 4px;
        }

        .slds-radio:hover input ~ .checkmark, .slds-checkbox:hover input ~ .checkmark {
            border-color: var(--brand-text-mid);
        }

        .slds-radio input:focus ~ .checkmark, .slds-checkbox input:focus ~ .checkmark {
            border-color: var(--brand-blue);
            box-shadow: 0 0 0 2px rgba(0, 74, 128, 0.2);
        }

        /* Checked States */
        .slds-radio input:checked ~ .checkmark, .slds-checkbox input:checked ~ .checkmark {
            border-color: var(--brand-primary-red);
        }
        
        .slds-radio .checkmark:after, .slds-checkbox .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }
        
        .slds-radio input:checked ~ .checkmark:after, .slds-checkbox input:checked ~ .checkmark:after {
            display: block;
        }
        
        /* ⚠️ CRITICAL: Radio dot is Empower Red */
        .slds-radio .checkmark:after {
            top: 4px;
            left: 4px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--brand-primary-red);
        }
        
        /* ⚠️ CRITICAL: Checkbox checkmark is Empower Red */
        .slds-checkbox .checkmark:after {
            left: 6px;
            top: 2px;
            width: 5px;
            height: 10px;
            border-style: solid;
            border-color: var(--brand-primary-red);
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        /* --- FILE UPLOAD (SLDS Inspired) --- */
        .slds-file-selector {
            border: 1px dashed var(--brand-border-light);
            border-radius: 4px;
            padding: var(--spacing-lg);
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s, background-color 0.2s;
        }
        .slds-file-selector:hover {
            border-color: var(--brand-blue);
            background-color: #E5EDF2;
        }
        .slds-file-selector__text {
            color: var(--brand-blue);
            font-weight: 600;
        }
        .slds-file-selector__subtext {
            color: var(--brand-text-mid);
            font-size: 0.875rem;
            margin-top: var(--spacing-xs);
        }
        #tfn-file-name {
            margin-top: var(--spacing-sm);
            font-style: italic;
        }
        #tfn-file-upload-input {
            display: none;
        }

        /* --- BUTTONS (SLDS Inspired) --- */
        .slds-button {
            border: 1px solid transparent;
            border-radius: 4px;
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s, border-color 0.2s, color 0.2s;
        }
        .slds-button:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--brand-white), 0 0 0 4px var(--brand-blue);
        }

        .slds-button--brand {
            background-color: var(--brand-primary-red);
            color: var(--brand-white);
        }
        .slds-button--brand:hover {
            background-color: var(--brand-primary-red-dark);
        }
        .slds-button--brand:disabled {
            background-color: var(--brand-background-disabled);
            color: var(--brand-text-mid);
            cursor: not-allowed;
        }

        .slds-button--neutral {
            background-color: var(--brand-white);
            color: var(--brand-text-dark);
            border-color: var(--brand-border-light);
        }
        .slds-button--neutral:hover {
            background-color: var(--brand-background-light);
        }

        /* --- UTILITY & HELPER CLASSES --- */
        .slds-hide {
            display: none !important;
        }
        .slds-grid {
            display: flex;
            gap: var(--spacing-lg);
        }
        .slds-col {
            flex: 1;
        }
        .info-badge {
            display: inline-block;
            background-color: #E5EDF2;
            color: var(--brand-blue);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .dynamic-section {
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out, margin 0.5s ease-in-out;
            max-height: 0;
            opacity: 0;
            margin-top: 0;
            padding-top: 0;
        }
        .dynamic-section.visible {
            max-height: 500px; /* Adjust as needed */
            opacity: 1;
            margin-top: var(--spacing-lg);
            padding-top: var(--spacing-lg);
        }

        /* --- STATES: LOADING, SUCCESS --- */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.3s ease-out;
        }
        .spinner {
            border: 4px solid var(--brand-background-light);
            border-top: 4px solid var(--brand-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-state {
            text-align: center;
            padding: var(--spacing-xxl) var(--spacing-lg);
        }
        .success-icon {
            width: 64px;
            height: 64px;
            color: var(--brand-green);
            margin-bottom: var(--spacing-lg);
        }

        /* --- RESPONSIVE DESIGN --- */
        @media (max-width: 600px) {
            body {
                padding: var(--spacing-sm);
            }
            .heading-1 {
                font-size: 1.5rem; /* 24px */
            }
            .slds-grid {
                flex-direction: column;
                gap: 0;
            }
            .slds-card__body, .slds-card__header, .slds-card__footer {
                padding: var(--spacing-md);
            }
            .slds-card__footer {
                flex-direction: column-reverse;
                gap: var(--spacing-sm);
            }
            .slds-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>

    <main class="container" role="main">
        <!-- Initial Loading State -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="spinner"></div>
        </div>

        <!-- Form Container -->
        <div id="form-container" class="slds-card slds-hide">
            <header class="slds-card__header">
                <h1 class="heading-1">Interim Benefit Offer</h1>
                <div class="slds-grid">
                    <div class="slds-col">
                        <span class="body-paragraph">Injured Worker</span><br>
                        <span id="worker-name" class="body-large-strong"></span>
                    </div>
                    <div class="slds-col">
                        <span class="body-paragraph">Claim Number</span><br>
                        <span id="claim-number" class="body-large-strong"></span>
                    </div>
                </div>
            </header>

            <form id="benefit-form" novalidate>
                <div class="slds-card__body">
                    
                    <!-- Medical Expenses Offer -->
                    <section id="medical-offer-section" class="slds-section">
                        <h2 class="heading-3">Medical Expenses</h2>
                        <div class="slds-form-element">
                            <label class="slds-form-element__label" id="medical-question-label">
                                Are you intending to claim medical expenses while your claim is being assessed?
                            </label>
                            <div role="radiogroup" aria-labelledby="medical-question-label">
                                <label class="slds-radio">
                                    <input type="radio" name="medicalResponse" value="yes" required>
                                    <span class="checkmark"></span>
                                    <span class="slds-radio__label">Yes</span>
                                </label>
                                <label class="slds-radio">
                                    <input type="radio" name="medicalResponse" value="no" required>
                                    <span class="checkmark"></span>
                                    <span class="slds-radio__label">No</span>
                                </label>
                            </div>
                            <div id="medicalResponse-error" class="slds-form-element__help" role="alert"></div>
                        </div>
                    </section>

                    <!-- Income Support Offer -->
                    <section id="income-offer-section" class="slds-section">
                        <h2 class="heading-3">Income Support</h2>
                        <div class="slds-grid">
                             <div class="slds-col">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Weekly Benefit Amount</label>
                                    <span id="weekly-benefit" class="info-badge"></span>
                                </div>
                            </div>
                            <div class="slds-col">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Start Date</label>
                                    <span id="start-date" class="info-badge"></span>
                                </div>
                            </div>
                        </div>
                        <div class="slds-form-element">
                            <label class="slds-form-element__label" id="income-question-label">
                                Do you accept this offer?
                            </label>
                            <div role="radiogroup" aria-labelledby="income-question-label">
                                <label class="slds-radio">
                                    <input type="radio" name="incomeSupportResponse" value="accept" required>
                                    <span class="checkmark"></span>
                                    <span class="slds-radio__label">Accept</span>
                                </label>
                                <label class="slds-radio">
                                    <input type="radio" name="incomeSupportResponse" value="not-accept" required>
                                    <span class="checkmark"></span>
                                    <span class="slds-radio__label">Not Accept</span>
                                </label>
                            </div>
                            <div id="incomeSupportResponse-error" class="slds-form-element__help" role="alert"></div>
                        </div>
                    </section>

                    <!-- EFT Details Section (Conditional) -->
                    <section id="eft-section" class="slds-section dynamic-section">
                        <h2 class="heading-3">Electronic Funds Transfer (EFT) Details</h2>
                        <p class="body-paragraph">Please provide your bank details for payment.</p>
                        <div class="slds-form-element">
                            <label class="slds-form-element__label" for="bank-account-name">Bank Account Name</label>
                            <input type="text" id="bank-account-name" class="slds-input" placeholder="e.g., J Doe">
                            <div id="bank-account-name-error" class="slds-form-element__help" role="alert"></div>
                        </div>
                        <div class="slds-grid">
                            <div class="slds-col">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label" for="bsb">BSB</label>
                                    <input type="text" id="bsb" class="slds-input" placeholder="e.g., 000-000" maxlength="7">
                                    <div id="bsb-error" class="slds-form-element__help" role="alert"></div>
                                </div>
                            </div>
                            <div class="slds-col">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label" for="account-number">Account Number</label>
                                    <input type="text" id="account-number" class="slds-input" placeholder="e.g., 123456789">
                                    <div id="account-number-error" class="slds-form-element__help" role="alert"></div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- TFN Upload Section (Conditional) -->
                    <section id="tfn-section" class="slds-section dynamic-section">
                        <h2 class="heading-3">TFN Declaration Form</h2>
                        <p class="body-paragraph">To ensure you are taxed correctly, please upload a completed Tax File Number declaration form.</p>
                        <div class="slds-form-element">
                            <label class="slds-file-selector" for="tfn-file-upload-input" id="tfn-drop-zone">
                                <span class="slds-file-selector__text">Upload File</span>
                                <span class="slds-file-selector__subtext">PDF, PNG, JPG accepted</span>
                            </label>
                             <input type="file" id="tfn-file-upload-input" accept=".pdf,.png,.jpg,.jpeg">
                            <div id="tfn-file-name" class="body-small"></div>
                            <div id="tfn-file-upload-input-error" class="slds-form-element__help" role="alert"></div>
                        </div>
                    </section>
                    
                    <!-- Declaration Checkbox -->
                    <section id="declaration-section" class="slds-section">
                         <div class="slds-form-element">
                            <label class="slds-checkbox">
                                <input type="checkbox" id="declaration" name="declaration">
                                <span class="checkmark"></span>
                                <span id="declaration-label" class="slds-checkbox__label">I understand that by not accepting an offer, my interim benefits may be affected.</span>
                            </label>
                            <div id="declaration-error" class="slds-form-element__help" role="alert"></div>
                        </div>
                    </section>

                </div>

                <footer class="slds-card__footer">
                    <button type="button" id="draft-button" class="slds-button slds-button--neutral">Save as Draft</button>
                    <button type="submit" id="submit-button" class="slds-button slds-button--brand">Submit Response</button>
                </footer>
            </form>
        </div>

        <!-- Success/Expired State Container -->
        <div id="success-container" class="slds-card slds-hide">
            <div class="success-state">
                <svg class="success-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" fill="currentColor">
                    <path d="M26,0A26,26,0,1,0,52,26,26,26,0,0,0,26,0Zm0,50A24,24,0,1,1,50,26,24,24,0,0,1,26,50Z"/>
                    <path d="M38.2,16.4a2,2,0,0,0-2.8,0l-13,13-5.6-5.6a2,2,0,0,0-2.8,2.8l7,7a2,2,0,0,0,2.8,0l14.4-14.4A2,2,0,0,0,38.2,16.4Z"/>
                </svg>
                <h2 class="heading-3">Thank You For Your Response</h2>
                <p class="body-paragraph">Your response was submitted on <strong id="submission-timestamp"></strong>.</p>
                <p class="body-paragraph">This link has now expired. Please contact us if you have any questions.</p>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- MOCK DATA ---
            const mockData = {
                workerName: 'Jane Doe',
                claimNumber: 'CLM-2024-00123',
                weeklyBenefit: '$745.50',
                startDate: '25 July 2024',
                offers: {
                    medical: true,
                    incomeSupport: true,
                }
            };

            // --- DOM ELEMENT SELECTORS ---
            const formContainer = document.getElementById('form-container');
            const loadingOverlay = document.getElementById('loading-overlay');
            const successContainer = document.getElementById('success-container');
            const benefitForm = document.getElementById('benefit-form');
            const submitButton = document.getElementById('submit-button');

            const medicalOfferSection = document.getElementById('medical-offer-section');
            const incomeOfferSection = document.getElementById('income-offer-section');
            const eftSection = document.getElementById('eft-section');
            const tfnSection = document.getElementById('tfn-section');
            const declarationSection = document.getElementById('declaration-section');
            const declarationCheckbox = document.getElementById('declaration');

            const medicalRadios = document.querySelectorAll('input[name="medicalResponse"]');
            const incomeRadios = document.querySelectorAll('input[name="incomeSupportResponse"]');
            
            // --- INITIALIZATION ---
            function initializePage() {
                // Simulate fetching data
                setTimeout(() => {
                    populateData(mockData);
                    addEventListeners();
                    updateUIState();
                    
                    loadingOverlay.style.opacity = '0';
                    setTimeout(() => loadingOverlay.classList.add('slds-hide'), 300);
                    formContainer.classList.remove('slds-hide');
                }, 1000);
            }

            function populateData(data) {
                document.getElementById('worker-name').textContent = data.workerName;
                document.getElementById('claim-number').textContent = data.claimNumber;

                if (!data.offers.medical) medicalOfferSection.classList.add('slds-hide');
                if (data.offers.incomeSupport) {
                    document.getElementById('weekly-benefit').textContent = data.weeklyBenefit;
                    document.getElementById('start-date').textContent = data.startDate;
                } else {
                    incomeOfferSection.classList.add('slds-hide');
                }
            }

            // --- EVENT LISTENERS ---
            function addEventListeners() {
                medicalRadios.forEach(radio => radio.addEventListener('change', updateUIState));
                incomeRadios.forEach(radio => radio.addEventListener('change', updateUIState));
                benefitForm.addEventListener('submit', handleFormSubmit);

                const tfnUploadInput = document.getElementById('tfn-file-upload-input');
                const tfnDropZone = document.getElementById('tfn-drop-zone');
                tfnUploadInput.addEventListener('change', () => {
                    const fileNameDisplay = document.getElementById('tfn-file-name');
                    if(tfnUploadInput.files.length > 0) {
                        fileNameDisplay.textContent = `Selected file: ${tfnUploadInput.files[0].name}`;
                    } else {
                        fileNameDisplay.textContent = '';
                    }
                });
            }

            // --- UI LOGIC ---
            function updateUIState() {
                const medicalResponse = getSelectedRadioValue('medicalResponse');
                const incomeResponse = getSelectedRadioValue('incomeSupportResponse');

                // EFT section visibility
                const showEFT = medicalResponse === 'yes' || incomeResponse === 'accept';
                toggleSectionVisibility(eftSection, showEFT);

                // TFN section visibility
                const showTFN = incomeResponse === 'accept';
                toggleSectionVisibility(tfnSection, showTFN);
                
                // Set required attributes for EFT/TFN fields
                setRequiredForGroup(['bank-account-name', 'bsb', 'account-number'], showEFT);
                setRequiredForGroup(['tfn-file-upload-input'], showTFN);

                // Declaration checkbox requirement
                const declarationRequired = medicalResponse === 'no' || incomeResponse === 'not-accept';
                declarationSection.style.display = declarationRequired ? 'block' : 'none';
                declarationCheckbox.required = declarationRequired;
            }

            function getSelectedRadioValue(name) {
                const selectedRadio = document.querySelector(`input[name="${name}"]:checked`);
                return selectedRadio ? selectedRadio.value : null;
            }

            function toggleSectionVisibility(section, isVisible) {
                if (isVisible) {
                    section.classList.add('visible');
                } else {
                    section.classList.remove('visible');
                }
            }
            
            function setRequiredForGroup(elementIds, isRequired) {
                elementIds.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.required = isRequired;
                });
            }

            // --- FORM SUBMISSION & VALIDATION ---
            function handleFormSubmit(event) {
                event.preventDefault();
                clearAllErrors();
                if (validateForm()) {
                    submitButton.disabled = true;
                    submitButton.innerHTML = `<span class="spinner" style="width:20px; height:20px; border-width: 2px; border-top-color: var(--brand-white); margin-right: 8px;"></span> Submitting...`;

                    // Simulate API call
                    setTimeout(() => {
                        showSuccessState();
                    }, 2000);
                }
            }

            function validateForm() {
                let isValid = true;
                const requiredFields = Array.from(benefitForm.querySelectorAll('[required]'));

                requiredFields.forEach(field => {
                    let fieldValid = true;
                    const parentFormElement = field.closest('.slds-form-element');

                    if (field.type === 'radio') {
                        const radioGroup = document.querySelectorAll(`input[name="${field.name}"]`);
                        if (![...radioGroup].some(r => r.checked)) {
                           fieldValid = false;
                           showError(field.name, 'Please select an option.');
                        }
                    } else if (field.type === 'checkbox') {
                         if (!field.checked) {
                           fieldValid = false;
                           showError(field.id, 'This declaration is required to proceed.');
                        }
                    } else { // Text inputs, file inputs
                        if (field.value.trim() === '') {
                           fieldValid = false;
                           showError(field.id, 'This field is required.');
                        }
                    }
                    
                    if(!fieldValid) {
                        isValid = false;
                        if(parentFormElement) parentFormElement.classList.add('slds-has-error');
                    }
                });
                return isValid;
            }

            function showError(fieldId, message) {
                const errorElement = document.getElementById(`${fieldId}-error`);
                if (errorElement) {
                    errorElement.textContent = message;
                }
            }
            
            function clearAllErrors() {
                document.querySelectorAll('.slds-form-element__help').forEach(el => el.textContent = '');
                document.querySelectorAll('.slds-has-error').forEach(el => el.classList.remove('slds-has-error'));
            }

            function showSuccessState() {
                const now = new Date();
                const timestamp = now.toLocaleDateString('en-GB', {
                    day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit'
                });
                document.getElementById('submission-timestamp').textContent = timestamp;

                formContainer.style.opacity = '0';
                setTimeout(() => {
                    formContainer.classList.add('slds-hide');
                    successContainer.classList.remove('slds-hide');
                    window.scrollTo(0, 0);
                }, 300);
            }

            // --- START THE APP ---
            initializePage();
        });
    </script>
</body>
</html>