<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evidence Received Console</title>
    <style>
        /* --- DESIGN SYSTEM & SLDS EMULATION --- */
        :root {
            /* Legal Aid Colour Palette */
            --brand-primary-red: #C10E02;
            --brand-trusted-blue: #004A80;
            --brand-calming-green: #21A179;
            --brand-optimistic-orange: #FF9F1C;
            --brand-purple-care: #B46CAC;
            
            --brand-text-primary: #1D1D1D;
            --brand-text-secondary: #545454;
            --brand-text-on-color: #FFFFFF;
            --brand-text-link: #004A80;
            --brand-text-placeholder: #737373;

            --ui-background: #F4F5F6;
            --ui-background-alt: #FFFFFF;
            --ui-border-primary: #C8C8C8;
            --ui-border-secondary: #E6E6E6;
            --ui-border-focus: #004A80;
            --ui-disabled: #E6E6E6;
            --ui-disabled-text: #919191;

            /* Status Colors */
            --status-unreviewed-bg: #E5EDF2; /* Light Blue */
            --status-unreviewed-text: #002C4D; /* Dark Blue */
            --status-verified-bg: #D3ECE4; /* Light Green */
            --status-verified-text: #005F44; /* Dark Green */
            --status-rejected-bg: #FAE7E6; /* Light Red */
            --status-rejected-text: #A10C02; /* Dark Red */
            --status-inprogress-bg: #FEF6E8; /* Light Orange */
            --status-inprogress-text: #7C4E0D; /* Dark Orange */

            /* Spacing (8px grid) */
            --space-xxs: 4px;
            --space-xs: 8px;
            --space-sm: 12px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;

            /* Typography */
            --font-family-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            --font-size-h1: 2rem;
            --font-size-h2: 1.5rem;
            --font-size-body: 0.875rem; /* 14px */
            --font-size-small: 0.75rem; /* 12px */

            /* Effects */
            --shadow-card: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-panel: 0 8px 16px -4px rgba(0, 0, 0, 0.1), 0 0 1px 0 rgba(0, 0, 0, 0.05);
            --border-radius: 4px;
            --transition-speed: 0.2s;
        }

        /* --- GLOBAL RESETS & STYLES --- */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: var(--font-family-sans);
            background-color: var(--ui-background);
            color: var(--brand-text-primary);
            font-size: var(--font-size-body);
            line-height: 1.5;
        }

        /* --- LAYOUT & CONTAINER --- */
        .container {
            padding: var(--space-lg);
            max-width: 1440px;
            margin: 0 auto;
        }

        .card {
            background-color: var(--ui-background-alt);
            border: 1px solid var(--ui-border-secondary);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-card);
            overflow: hidden;
        }

        /* --- PAGE HEADER --- */
        .page-header {
            margin-bottom: var(--space-lg);
        }

        .page-header h1 {
            font-size: var(--font-size-h1);
            font-weight: 600;
            margin: 0 0 var(--space-xs) 0;
            color: var(--brand-text-primary);
        }

        .page-header p {
            font-size: var(--font-size-body);
            color: var(--brand-text-secondary);
            margin: 0;
        }

        /* --- FILTER BAR --- */
        .filter-bar {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-md);
            padding: var(--space-md);
            border-bottom: 1px solid var(--ui-border-secondary);
        }

        .search-container {
            position: relative;
            flex-grow: 1;
            min-width: 250px;
        }

        .search-container .icon {
            position: absolute;
            top: 50%;
            left: var(--space-sm);
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            color: var(--brand-text-placeholder);
        }

        .input-field {
            width: 100%;
            padding: var(--space-xs) var(--space-sm);
            border: 1px solid var(--ui-border-primary);
            border-radius: var(--border-radius);
            font-size: var(--font-size-body);
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
        }
        
        .input-field::placeholder {
            color: var(--brand-text-placeholder);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--ui-border-focus);
            box-shadow: 0 0 0 1px var(--ui-border-focus);
        }

        .search-input {
            padding-left: calc(var(--space-sm) + 24px);
        }

        .filter-group {
            position: relative;
            min-width: 180px;
        }

        /* --- BUTTONS --- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-xs) var(--space-md);
            font-size: var(--font-size-body);
            font-weight: 600;
            border-radius: var(--border-radius);
            border: 1px solid transparent;
            cursor: pointer;
            text-decoration: none;
            transition: background-color var(--transition-speed), border-color var(--transition-speed), color var(--transition-speed);
        }

        .btn:disabled {
            background-color: var(--ui-disabled);
            color: var(--ui-disabled-text);
            cursor: not-allowed;
            border-color: var(--ui-disabled);
        }

        .btn-secondary {
            background-color: var(--ui-background-alt);
            color: var(--brand-text-link);
            border-color: var(--ui-border-primary);
        }

        .btn-secondary:not(:disabled):hover {
            background-color: #f2f2f2;
        }
        
        .btn-icon {
            background: none;
            border: none;
            padding: var(--space-xxs);
            color: var(--brand-text-secondary);
        }
        .btn-icon:hover {
            color: var(--brand-text-primary);
        }

        /* --- TABLE --- */
        .table-wrapper {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--font-size-body);
        }

        .data-table th, .data-table td {
            padding: var(--space-sm) var(--space-md);
            text-align: left;
            border-bottom: 1px solid var(--ui-border-secondary);
            white-space: nowrap;
        }

        .data-table th {
            font-weight: 600;
            color: var(--brand-text-secondary);
            text-transform: uppercase;
            font-size: var(--font-size-small);
            position: sticky;
            top: 0;
            background-color: var(--ui-background-alt);
            z-index: 1;
        }
        
        .data-table th.sortable {
            cursor: pointer;
            user-select: none;
        }
        
        .data-table th.sortable:hover {
            color: var(--brand-text-primary);
        }

        .sort-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-left: var(--space-xs);
            vertical-align: middle;
            opacity: 0.5;
            transition: opacity var(--transition-speed);
        }
        
        .data-table th.sortable:hover .sort-icon {
            opacity: 1;
        }

        .data-table th.active .sort-icon {
            opacity: 1;
            color: var(--brand-trusted-blue);
        }

        .data-table tbody tr {
            transition: background-color var(--transition-speed);
        }

        .data-table tbody tr:hover {
            background-color: #f9f9f9;
        }
        
        .data-table tbody tr.clickable {
            cursor: pointer;
        }

        .evidence-name-cell {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            font-weight: 600;
            color: var(--brand-text-link);
        }

        .evidence-name-cell .icon {
            width: 18px;
            height: 18px;
            color: var(--brand-text-secondary);
            flex-shrink: 0;
        }

        /* --- STATUS PILLS --- */
        .status-pill {
            display: inline-block;
            padding: var(--space-xxs) var(--space-xs);
            border-radius: 1rem;
            font-size: var(--font-size-small);
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pill[data-status="Unreviewed"] {
            background-color: var(--status-unreviewed-bg);
            color: var(--status-unreviewed-text);
        }
        .status-pill[data-status="Verified"] {
            background-color: var(--status-verified-bg);
            color: var(--status-verified-text);
        }
        .status-pill[data-status="Rejected"] {
            background-color: var(--status-rejected-bg);
            color: var(--status-rejected-text);
        }
        .status-pill[data-status="In Progress"] {
            background-color: var(--status-inprogress-bg);
            color: var(--status-inprogress-text);
        }

        /* --- PAGINATION --- */
        .pagination-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            padding: var(--space-md);
            font-size: var(--font-size-body);
            color: var(--brand-text-secondary);
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .page-numbers span {
            padding: var(--space-xs);
            font-weight: 600;
        }

        /* --- EMPTY/NO RESULTS STATE --- */
        .empty-state {
            text-align: center;
            padding: var(--space-xl) var(--space-lg);
        }
        
        .empty-state .icon {
            width: 64px;
            height: 64px;
            color: var(--ui-border-primary);
            margin-bottom: var(--space-md);
        }
        
        .empty-state h2 {
            font-size: var(--font-size-h2);
            color: var(--brand-text-primary);
            margin: 0 0 var(--space-xs);
        }

        .empty-state p {
            color: var(--brand-text-secondary);
            margin: 0;
        }
        
        .empty-state .clear-filters-link {
            color: var(--brand-text-link);
            font-weight: 600;
            cursor: pointer;
            text-decoration: underline;
        }

        /* --- DETAILS SIDE PANEL --- */
        .details-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-speed), visibility var(--transition-speed);
        }
        
        .details-panel-overlay.is-visible {
            opacity: 1;
            visibility: visible;
        }

        .details-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            max-width: 500px;
            height: 100%;
            background-color: var(--ui-background-alt);
            box-shadow: var(--shadow-panel);
            z-index: 101;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
        }
        
        .details-panel.is-visible {
            transform: translateX(0);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md);
            border-bottom: 1px solid var(--ui-border-secondary);
            flex-shrink: 0;
        }
        
        .panel-header h2 {
            font-size: 1.25rem;
            margin: 0;
            font-weight: 600;
        }

        .panel-body {
            padding: var(--space-lg);
            overflow-y: auto;
            flex-grow: 1;
        }
        
        .detail-group {
            margin-bottom: var(--space-lg);
        }
        
        .detail-group h3 {
            font-size: var(--font-size-small);
            text-transform: uppercase;
            color: var(--brand-text-secondary);
            margin: 0 0 var(--space-sm) 0;
            font-weight: 600;
        }
        
        .detail-item {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: var(--space-md);
            padding: var(--space-sm) 0;
            border-bottom: 1px solid var(--ui-border-secondary);
        }
        
        .detail-item:last-child {
            border-bottom: none;
        }
        
        .detail-item dt {
            color: var(--brand-text-secondary);
        }

        .detail-item dd {
            margin: 0;
            font-weight: 600;
            color: var(--brand-text-primary);
        }

        /* --- RESPONSIVENESS --- */
        @media (max-width: 768px) {
            .container {
                padding: var(--space-md);
            }
            .filter-bar {
                flex-direction: column;
            }
            .pagination-footer {
                flex-direction: column;
                gap: var(--space-md);
            }
            .page-header h1 {
                font-size: 1.75rem;
            }
            .details-panel {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>

    <main class="container">
        <!-- PAGE HEADER -->
        <header class="page-header">
            <h1>Evidence Received</h1>
            <p id="table-summary">All received evidence items for this claim.</p>
        </header>

        <!-- MAIN CONTENT CARD -->
        <div class="card">
            <!-- FILTER BAR -->
            <div class="filter-bar">
                <div class="search-container">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
                    </svg>
                    <input type="search" id="search-input" class="input-field search-input" placeholder="Search by description, claim, case..." aria-label="Search evidence table">
                </div>
                <div class="filter-group">
                    <select id="status-filter" class="input-field" aria-label="Filter by status">
                        <option value="all">All Statuses</option>
                        <option value="Unreviewed">Unreviewed</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Verified">Verified</option>
                        <option value="Rejected">Rejected</option>
                    </select>
                </div>
            </div>

            <!-- DATA TABLE -->
            <div class="table-wrapper">
                <table class="data-table" aria-live="polite">
                    <thead>
                        <tr>
                            <th>Evidence Name</th>
                            <th>Request Type</th>
                            <th>Claim Number</th>
                            <th>Case Number</th>
                            <th class="sortable" data-sort="status" aria-sort="none">
                                Status
                                <svg class="sort-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.5a.75.75 0 01-1.5 0V3.75A.75.75 0 0110 3z" clip-rule="evenodd" /><path d="M10 18a8 8 0 100-16 8 8 0 000 16zm-5.5-8a5.5 5.5 0 1111 0 5.5 5.5 0 01-11 0z" /></svg>
                            </th>
                            <th class="sortable" data-sort="receivedDateTime" aria-sort="descending">
                                Received Date & Time
                                <svg class="sort-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.5a.75.75 0 01-1.5 0V3.75A.75.75 0 0110 3z" clip-rule="evenodd" /><path d="M10 18a8 8 0 100-16 8 8 0 000 16zm-5.5-8a5.5 5.5 0 1111 0 5.5 5.5 0 01-11 0z" /></svg>
                            </th>
                            <th>No. of Docs</th>
                        </tr>
                    </thead>
                    <tbody id="evidence-table-body">
                        <!-- Rows will be dynamically inserted here -->
                    </tbody>
                </table>
                 <div id="empty-state-container" class="empty-state" style="display: none;">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m5.231 13.481L15 17.25m-4.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9zm3.75 11.625a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                    </svg>
                    <h2 id="empty-state-title">No matching evidence found</h2>
                    <p id="empty-state-message">Try adjusting your search or filter criteria.</p>
                </div>
            </div>

            <!-- PAGINATION FOOTER -->
            <footer class="pagination-footer">
                <div id="pagination-info">Showing 1 to 10 of 24 items</div>
                <div class="pagination-controls">
                    <button id="prev-page-btn" class="btn btn-secondary">&lt; Previous</button>
                    <div class="page-numbers">
                        Page <span id="current-page-number">1</span>
                    </div>
                    <button id="next-page-btn" class="btn btn-secondary">Next &gt;</button>
                </div>
            </footer>
        </div>
    </main>

    <!-- DETAILS SIDE PANEL -->
    <div class="details-panel-overlay" id="details-panel-overlay" role="dialog" aria-modal="true" aria-labelledby="panel-title">
        <div class="details-panel" id="details-panel">
            <header class="panel-header">
                <h2 id="panel-title">Evidence Details</h2>
                <button class="btn btn-icon" id="close-panel-btn" aria-label="Close details panel">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="24" height="24">
                        <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
                    </svg>
                </button>
            </header>
            <div class="panel-body" id="panel-body-content">
                <!-- Details will be dynamically inserted here -->
            </div>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', function () {

        // --- SAMPLE DATA ---
        const sampleEvidenceData = [
            { id: 1, name: 'Medical Report - Dr. Smith', requestType: 'Medical Records', claim: 'CLM-00123', case: 'CSE-00456', status: 'Unreviewed', receivedDateTime: '2023-10-27T14:30:00Z', docs: 3 },
            { id: 2, name: 'Bank Statement - Jan 2023', requestType: 'Financial Statement', claim: 'CLM-00123', case: 'CSE-00456', status: 'Verified', receivedDateTime: '2023-10-26T10:15:00Z', docs: 12 },
            { id: 3, name: 'Employment Contract', requestType: 'Proof of Employment', claim: 'CLM-00124', case: 'CSE-00457', status: 'In Progress', receivedDateTime: '2023-10-25T09:00:00Z', docs: 2 },
            { id: 4, name: 'Police Report - Incident #4532', requestType: 'Incident Report', claim: 'CLM-00125', case: 'CSE-00458', status: 'Unreviewed', receivedDateTime: '2023-11-01T11:45:00Z', docs: 5 },
            { id: 5, name: 'Utility Bill - Water', requestType: 'Proof of Address', claim: 'CLM-00126', case: 'CSE-00459', status: 'Rejected', receivedDateTime: '2023-10-28T16:00:00Z', docs: 1 },
            { id: 6, name: 'Lease Agreement', requestType: 'Proof of Address', claim: 'CLM-00126', case: 'CSE-00459', status: 'Verified', receivedDateTime: '2023-11-02T13:20:00Z', docs: 8 },
            { id: 7, name: 'Witness Statement - J. Doe', requestType: 'Witness Testimony', claim: 'CLM-00125', case: 'CSE-00458', status: 'Unreviewed', receivedDateTime: '2023-11-03T10:05:00Z', docs: 2 },
            { id: 8, name: 'Pay Stubs (Last 3 Months)', requestType: 'Proof of Income', claim: 'CLM-00124', case: 'CSE-00457', status: 'In Progress', receivedDateTime: '2023-10-29T17:55:00Z', docs: 6 },
            { id: 9, name: 'Photo Evidence - Damage', requestType: 'Visual Evidence', claim: 'CLM-00125', case: 'CSE-00458', status: 'Verified', receivedDateTime: '2023-11-04T09:30:00Z', docs: 25 },
            { id: 10, name: 'Expert Report - Engineering', requestType: 'Expert Opinion', claim: 'CLM-00127', case: 'CSE-00460', status: 'Unreviewed', receivedDateTime: '2023-11-05T15:00:00Z', docs: 42 },
            { id: 11, name: 'Psychological Assessment', requestType: 'Medical Records', claim: 'CLM-00128', case: 'CSE-00461', status: 'In Progress', receivedDateTime: '2023-11-06T11:10:00Z', docs: 15 },
            { id: 12, name: 'Tax Returns 2022', requestType: 'Financial Statement', claim: 'CLM-00124', case: 'CSE-00457', status: 'Verified', receivedDateTime: '2023-11-01T18:00:00Z', docs: 22 },
            { id: 13, name: 'School Enrollment Letter', requestType: 'Proof of Dependency', claim: 'CLM-00129', case: 'CSE-00462', status: 'Unreviewed', receivedDateTime: '2023-11-07T08:45:00Z', docs: 1 },
            { id: 14, name: 'Vehicle Registration', requestType: 'Proof of Ownership', claim: 'CLM-00125', case: 'CSE-00458', status: 'Verified', receivedDateTime: '2023-10-30T12:00:00Z', docs: 1 },
            { id: 15, name: 'Immigration Documents', requestType: 'Legal Status', claim: 'CLM-00130', case: 'CSE-00463', status: 'Unreviewed', receivedDateTime: '2023-11-08T16:20:00Z', docs: 7 },
        ];

        // --- DOM ELEMENTS ---
        const tableBody = document.getElementById('evidence-table-body');
        const searchInput = document.getElementById('search-input');
        const statusFilter = document.getElementById('status-filter');
        const prevPageBtn = document.getElementById('prev-page-btn');
        const nextPageBtn = document.getElementById('next-page-btn');
        const currentPageNumberEl = document.getElementById('current-page-number');
        const paginationInfoEl = document.getElementById('pagination-info');
        const tableSummaryEl = document.getElementById('table-summary');
        const sortableHeaders = document.querySelectorAll('.data-table th.sortable');
        const emptyStateContainer = document.getElementById('empty-state-container');
        const detailsPanelOverlay = document.getElementById('details-panel-overlay');
        const detailsPanel = document.getElementById('details-panel');
        const closePanelBtn = document.getElementById('close-panel-btn');
        const panelBodyContent = document.getElementById('panel-body-content');


        // --- STATE MANAGEMENT ---
        let state = {
            currentPage: 1,
            itemsPerPage: 10,
            searchTerm: '',
            statusFilter: 'all',
            sortColumn: 'receivedDateTime',
            sortDirection: 'desc',
            fullData: sampleEvidenceData,
            filteredData: sampleEvidenceData,
        };

        // --- UTILITY FUNCTIONS ---
        const debounce = (func, delay) => {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        };
        
        const formatDate = (dateString) => {
            const date = new Date(dateString);
            const options = { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: false };
            return date.toLocaleString('en-GB', options).replace(',', ',');
        };

        // --- DATA PROCESSING & RENDERING ---
        function applyFiltersAndSort() {
            let data = state.fullData;

            // Apply search term filter
            if (state.searchTerm) {
                const lowercasedTerm = state.searchTerm.toLowerCase();
                data = data.filter(item =>
                    item.name.toLowerCase().includes(lowercasedTerm) ||
                    item.claim.toLowerCase().includes(lowercasedTerm) ||
                    item.case.toLowerCase().includes(lowercasedTerm) ||
                    item.requestType.toLowerCase().includes(lowercasedTerm)
                );
            }

            // Apply status filter
            if (state.statusFilter !== 'all') {
                data = data.filter(item => item.status === state.statusFilter);
            }

            // Apply sorting
            if (state.sortColumn) {
                data.sort((a, b) => {
                    const valA = a[state.sortColumn];
                    const valB = b[state.sortColumn];
                    
                    if (valA < valB) return state.sortDirection === 'asc' ? -1 : 1;
                    if (valA > valB) return state.sortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
            }

            state.filteredData = data;
            state.currentPage = 1; // Reset to first page after filtering/sorting
        }

        function render() {
            applyFiltersAndSort();
            renderTable();
            renderPagination();
            updateSummary();
        }

        function renderTable() {
            tableBody.innerHTML = '';
            
            if (state.filteredData.length === 0) {
                emptyStateContainer.style.display = 'block';
                return;
            }
            emptyStateContainer.style.display = 'none';

            const start = (state.currentPage - 1) * state.itemsPerPage;
            const end = start + state.itemsPerPage;
            const pageData = state.filteredData.slice(start, end);

            pageData.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'clickable';
                row.dataset.id = item.id;
                row.setAttribute('role', 'button');
                row.setAttribute('tabindex', '0');

                row.innerHTML = `
                    <td>
                        <div class="evidence-name-cell">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                            </svg>
                            <span>${item.name}</span>
                        </div>
                    </td>
                    <td>${item.requestType}</td>
                    <td>${item.claim}</td>
                    <td>${item.case}</td>
                    <td><span class="status-pill" data-status="${item.status}">${item.status}</span></td>
                    <td>${formatDate(item.receivedDateTime)}</td>
                    <td>${item.docs}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function renderPagination() {
            const totalItems = state.filteredData.length;
            const totalPages = Math.ceil(totalItems / state.itemsPerPage);
            const startItem = (state.currentPage - 1) * state.itemsPerPage + 1;
            const endItem = Math.min(startItem + state.itemsPerPage - 1, totalItems);

            paginationInfoEl.textContent = totalItems > 0
                ? `Showing ${startItem} to ${endItem} of ${totalItems} items`
                : 'Showing 0 items';
            
            currentPageNumberEl.textContent = state.currentPage;

            prevPageBtn.disabled = state.currentPage === 1;
            nextPageBtn.disabled = state.currentPage === totalPages || totalItems === 0;
        }
        
        function updateSummary() {
            const totalItems = state.fullData.length;
            const unreviewedCount = state.fullData.filter(item => item.status === 'Unreviewed').length;
            tableSummaryEl.textContent = `${totalItems} items â€¢ ${unreviewedCount} Unreviewed`;
        }
        
        function updateSortHeaders() {
            sortableHeaders.forEach(header => {
                const sortKey = header.dataset.sort;
                if (sortKey === state.sortColumn) {
                    header.classList.add('active');
                    header.setAttribute('aria-sort', state.sortDirection === 'asc' ? 'ascending' : 'descending');
                } else {
                    header.classList.remove('active');
                    header.setAttribute('aria-sort', 'none');
                }
            });
        }
        
        function renderDetailsPanel(itemId) {
            const item = state.fullData.find(i => i.id === itemId);
            if (!item) return;

            document.getElementById('panel-title').textContent = item.name;
            
            panelBodyContent.innerHTML = `
                <div class="detail-group">
                    <h3>Evidence Details</h3>
                    <dl class="detail-item">
                        <dt>Request Type</dt>
                        <dd>${item.requestType}</dd>
                    </dl>
                    <dl class="detail-item">
                        <dt>Status</dt>
                        <dd><span class="status-pill" data-status="${item.status}">${item.status}</span></dd>
                    </dl>
                    <dl class="detail-item">
                        <dt>Received Date & Time</dt>
                        <dd>${formatDate(item.receivedDateTime)}</dd>
                    </dl>
                    <dl class="detail-item">
                        <dt>Number of Documents</dt>
                        <dd>${item.docs}</dd>
                    </dl>
                </div>
                <div class="detail-group">
                    <h3>Associated Records</h3>
                    <dl class="detail-item">
                        <dt>Claim Number</dt>
                        <dd>${item.claim}</dd>
                    </dl>
                    <dl class="detail-item">
                        <dt>Case Number</dt>
                        <dd>${item.case}</dd>
                    </dl>
                </div>
            `;
            detailsPanelOverlay.classList.add('is-visible');
            detailsPanel.classList.add('is-visible');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
            closePanelBtn.focus();
        }

        function closeDetailsPanel() {
            detailsPanelOverlay.classList.remove('is-visible');
            detailsPanel.classList.remove('is-visible');
            document.body.style.overflow = '';
        }

        // --- EVENT HANDLERS ---
        const handleSearch = debounce((event) => {
            state.searchTerm = event.target.value;
            render();
        }, 300);

        function handleStatusFilter(event) {
            state.statusFilter = event.target.value;
            render();
        }
        
        function handleSort(event) {
            const newSortColumn = event.currentTarget.dataset.sort;
            if (state.sortColumn === newSortColumn) {
                state.sortDirection = state.sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                state.sortColumn = newSortColumn;
                state.sortDirection = 'desc'; // Default to desc for new columns
            }
            updateSortHeaders();
            render();
        }

        function handlePrevPage() {
            if (state.currentPage > 1) {
                state.currentPage--;
                renderTable();
                renderPagination();
            }
        }
        
        function handleNextPage() {
            const totalPages = Math.ceil(state.filteredData.length / state.itemsPerPage);
            if (state.currentPage < totalPages) {
                state.currentPage++;
                renderTable();
                renderPagination();
            }
        }
        
        function handleRowClick(event) {
            const row = event.target.closest('tr.clickable');
            if (row) {
                const id = parseInt(row.dataset.id, 10);
                renderDetailsPanel(id);
            }
        }
        
        function handleRowKeyPress(event) {
            if (event.key === 'Enter' || event.key === ' ') {
                const row = event.target.closest('tr.clickable');
                if (row) {
                    event.preventDefault();
                    const id = parseInt(row.dataset.id, 10);
                    renderDetailsPanel(id);
                }
            }
        }

        // --- EVENT LISTENERS ---
        searchInput.addEventListener('input', handleSearch);
        statusFilter.addEventListener('change', handleStatusFilter);
        prevPageBtn.addEventListener('click', handlePrevPage);
        nextPageBtn.addEventListener('click', handleNextPage);
        sortableHeaders.forEach(header => header.addEventListener('click', handleSort));
        tableBody.addEventListener('click', handleRowClick);
        tableBody.addEventListener('keydown', handleRowKeyPress);
        closePanelBtn.addEventListener('click', closeDetailsPanel);
        detailsPanelOverlay.addEventListener('click', (e) => {
            if (e.target === detailsPanelOverlay) {
                closeDetailsPanel();
            }
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && detailsPanelOverlay.classList.contains('is-visible')) {
                closeDetailsPanel();
            }
        });

        // --- INITIALIZATION ---
        updateSortHeaders();
        render();
    });
    </script>
</body>
</html>